<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EL AFTO - Автосервис CRM</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="icon" type="image/x-icon" href="./img/logo.png">
    <style>
        :root {
            --primary: #0f0c29;
            --secondary: #302b63;
            --accent: #24243e;
            --text: #e6e6e6;
            --highlight: #00c9ff;
            --success: #00a86b;
            --warning: #ff9a3c;
            --danger: #ff4d4d;
            --card-bg: rgba(25, 22, 53, 0.7);
            --notification-success: #00a86b;
            --notification-error: #ff4d4d;
            --notification-warning: #ff9a3c;
            --calendar-day-bg: rgba(255, 255, 255, 0.05);
            --calendar-event-bg: rgba(0, 201, 255, 0.2);
            --calendar-today-bg: rgba(0, 168, 107, 0.2);
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, var(--primary), var(--secondary), var(--accent));
            color: var(--text);
            min-height: 100vh;
            padding: 20px;
            background-size: 400% 400%;
            animation: gradientBG 15s ease infinite;
        }
        
        @keyframes gradientBG {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
        }
        
        header {
            display: flex;
            justify-content: space-between;
            flex-direction: column;
            align-items: center;
            padding: 20px 0;
            margin-bottom: 30px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .logo {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .logo i {
            font-size: 2.5rem;
            background: linear-gradient(45deg, var(--highlight), var(--success));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        
        .logo h1 {
            font-size: 2.2rem;
            background: linear-gradient(45deg, #fff, var(--highlight));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            font-weight: 700;
            margin-bottom: 20px;
        }
        
        .nav-tabs {
            display: flex;
            gap: 1px;
            background: var(--card-bg);
            padding: 10px;
            border-radius: 50px;
            backdrop-filter: blur(10px);
            flex-wrap: wrap;
            justify-content: center;
        }
        
        .tab-btn {
            padding: 12px 25px;
            border-radius: 30px;
            background: transparent;
            border: none;
            color: var(--text);
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            white-space: nowrap;
        }
        
        .tab-btn:hover {
            background: rgba(255, 255, 255, 0.1);
        }
        
        .tab-btn.active {
            background: linear-gradient(90deg, var(--highlight), var(--success));
            color: white;
        }
        
        .content-section {
            display: none;
        }
        
        .content-section.active {
            display: block;
            animation: fadeIn 0.5s ease;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .section-title {
            font-size: 1.8rem;
            margin-bottom: 25px;
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        .section-title i {
            color: var(--highlight);
        }
        
        .card {
            background: var(--card-bg);
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 30px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            flex-wrap: wrap;
            gap: 15px;
        }
        
        .card-title {
            font-size: 1.8rem;
            font-weight: 600;
        }
        
        .btn {
            padding: 10px 20px;
            border-radius: 30px;
            border: none;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }
        
        .btn-primary {
            background: linear-gradient(90deg, var(--highlight), var(--success));
            color: white;
        }
        
        .btn-primary:hover {
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(0, 201, 255, 0.4);
        }
        
        .btn-secondary {
            background: rgba(255, 255, 255, 0.1);
            color: var(--text);
        }
        
        .btn-secondary:hover {
            background: rgba(255, 255, 255, 0.2);
        }
        
        .btn-danger {
            background: var(--danger);
            color: white;
        }
        
        .btn-sm {
            padding: 6px 12px;
            font-size: 0.85rem;
        }

        .btn-data {
            margin-top: 20px;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
        }
        
        th, td {
            padding: 15px;
            text-align: left;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        th {
            font-weight: 600;
            color: var(--highlight);
        }
        
        tr:hover {
            background: rgba(255, 255, 255, 0.05);
        }
        
        .actions {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
        }
        
        .action-btn {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            border: none;
            cursor: pointer;
            transition: all 0.3s ease;
            color: white;
        }
        
        .action-btn.call {
            background: var(--success);
        }
        
        .action-btn.whatsapp {
            background: #25D366;
        }
        
        .action-btn.telegram {
            background: #0088cc;
        }
        
        .action-btn.edit {
            background: var(--warning);
        }
        
        .action-btn.delete {
            background: var(--danger);
        }
        
        .action-btn:hover {
            transform: scale(1.1);
        }
        
        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 20px;
            margin-bottom: 25px;
        }
        
        .form-group {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }
        
        label {
            font-weight: 600;
            font-size: 0.95rem;
        }
        
        input, select, textarea {
            padding: 14px;
            border-radius: 8px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            background: rgba(0, 0, 0, 0.2);
            color: var(--text);
            font-size: 1rem;
        }
        
        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: var(--highlight);
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        
        .stat-card {
            background: linear-gradient(135deg, rgba(48, 43, 99, 0.7), rgba(15, 12, 41, 0.7));
            border-radius: 15px;
            padding: 25px;
            text-align: center;
            transition: transform 0.3s ease;
        }
        
        .stat-card:hover {
            transform: translateY(-5px);
        }
        
        .stat-value {
            font-size: 2.5rem;
            font-weight: 700;
            margin: 15px 0;
            background: linear-gradient(45deg, var(--highlight), var(--success));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        
        .stat-label {
            font-size: 1.1rem;
            color: rgba(255, 255, 255, 0.7);
        }
        
        .calculator-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
        }
        
        @media (max-width: 900px) {
            .calculator-grid {
                grid-template-columns: 1fr;
            }
        }
        
        .service-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 8px;
            margin-bottom: 12px;
        }
        
        .total-cost {
            font-size: 1.8rem;
            font-weight: 700;
            text-align: right;
            margin-top: 20px;
            background: linear-gradient(45deg, var(--highlight), var(--success));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        
        .import-export {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
        }
        
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 15px 25px;
            border-radius: 8px;
            color: white;
            font-weight: 600;
            box-shadow: 0 5px 25px rgba(0, 0, 0, 0.3);
            transform: translateX(120%);
            transition: transform 0.3s ease;
            z-index: 1000;
            display: flex;
            align-items: center;
            gap: 12px;
            max-width: 400px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.15);
        }
        
        .notification.show {
            transform: translateX(0);
        }
        
        .notification.success {
            background: rgba(0, 168, 107, 0.9);
        }
        
        .notification.error {
            background: rgba(255, 77, 77, 0.9);
        }
        
        .notification.warning {
            background: rgba(255, 154, 60, 0.9);
        }
        
        .notification i {
            font-size: 1.5rem;
        }
        
        .empty-state {
            text-align: center;
            padding: 50px 20px;
            color: rgba(255, 255, 255, 0.5);
        }
        
        .empty-state i {
            font-size: 4rem;
            margin-bottom: 20px;
            opacity: 0.3;
        }
        
        /* Поиск клиентов */
        .search-container {
            margin-bottom: 20px;
            display: flex;
            gap: 15px;
            align-items: center;
            flex-wrap: wrap;
        }
        
        .search-container label {
            font-size: 1rem;
        }
        
        .search-container input {
            flex: 1;
            min-width: 200px;
        }
        
        /* Автосохранение статус */
        .autosave-status {
            position: fixed;
            bottom: 15px;
            right: 15px;
            padding: 8px 15px;
            border-radius: 20px;
            background: rgba(0, 0, 0, 0.5);
            color: var(--text);
            font-size: 0.85rem;
            z-index: 100;
            display: flex;
            align-items: center;
            gap: 8px;
            opacity: 0.8;
        }
        
        /* Документы */
        .documents-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 25px;
            margin-top: 20px;
        }
        
        .document-card {
            background: rgba(48, 43, 99, 0.5);
            border-radius: 15px;
            padding: 25px;
            transition: all 0.3s ease;
            border: 1px solid rgba(255, 255, 255, 0.1);
            display: flex;
            flex-direction: column;
            gap: 15px;
        }
        
        .document-card:hover {
            transform: translateY(-5px);
            background: rgba(48, 43, 99, 0.7);
        }
        
        .document-icon {
            font-size: 2.5rem;
            color: var(--highlight);
            text-align: center;
        }
        
        .document-title {
            font-size: 1.3rem;
            font-weight: 600;
            text-align: center;
        }
        
        .document-desc {
            color: rgba(255, 255, 255, 0.7);
            text-align: center;
            flex-grow: 1;
        }
        
        .document-actions {
            display: flex;
            justify-content: center;
            gap: 10px;
        }
        
        .doc-btn {
            padding: 10px 15px;
            border-radius: 8px;
            border: none;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }
        
        .doc-btn.word {
            background: #2b579a;
            color: white;
        }
        
        .doc-btn.excel {
            background: #217346;
            color: white;
        }
        
        .doc-btn.pdf {
            background: #f40f02;
            color: white;
        }
        
        .doc-btn:hover {
            opacity: 0.9;
            transform: scale(1.05);
        }
        
        /* Обновленные стили для календаря */
        .calendar-container {
            background: var(--card-bg);
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 30px;
            overflow: hidden;
            border:aliceblue;
        }
        
        .calendar-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding: 0 10px;
            flex-wrap: wrap;
            gap: 15px;
            flex-direction: column;
        }
        
        .calendar-nav {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }
        
        .calendar-nav-btn {
            padding: 10px 15px;
            border-radius: 30px;
            background: rgba(255, 255, 255, 0.1);
            color: var(--text);
            border: none;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 600;
        }
        
        .calendar-nav-btn:hover {
            background: rgba(255, 255, 255, 0.2);
        }
        
        .calendar-title {
            font-size: 1.5rem;
            font-weight: 600;
            text-align: center;
            flex-grow: 1;
        }
        
        .calendar-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 8px;
        }
        
        .calendar-weekday {
            text-align: center;
            padding: 12px 5px;
            font-weight: 600;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 10px;
            display: flex;
            flex-direction: column;
            gap: 5px;
        }
        
        .weekday-name {
            font-size: 1.1rem;
            color: var(--highlight);
        }
        
        .weekday-date {
            font-size: 1.3rem;
            font-weight: 700;
        }
        
        .calendar-day {
            background: var(--calendar-day-bg);
            border-radius: 10px;
            min-height: 150px;
            padding: 10px;
            position: relative;
            overflow: hidden;
            border: 1px solid rgba(255, 255, 255, 0.05);
            display: flex;
            flex-direction: column;
            transition: all 0.3s ease;
        }
        
        .calendar-day.today {
            background: var(--calendar-today-bg);
            border: 1px solid var(--success);
            box-shadow: 0 0 15px rgba(0, 168, 107, 0.3);
        }
        
        .calendar-day.other-month {
            opacity: 0.4;
        }
        
        .calendar-day:hover {
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
            background: rgba(255, 255, 255, 0.08);
        }
        
        .day-number {
            font-weight: 700;
            font-size: 1.2rem;
            margin-bottom: 5px;
            text-align: right;
        }
        
        .day-events {
            flex-grow: 1;
            overflow-y: auto;
            max-height: 120px;
            padding-right: 3px;
        }
        
        .calendar-event {
            background: var(--calendar-event-bg);
            border-left: 3px solid var(--highlight);
            padding: 8px;
            margin-bottom: 8px;
            border-radius: 6px;
            font-size: 0.85rem;
            cursor: pointer;
            transition: all 0.2s ease;
            position: relative;
            overflow: hidden;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        
        .calendar-event:hover {
            background: rgba(0, 201, 255, 0.3);
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }
        
        .event-time {
            font-weight: 700;
            color: var(--highlight);
            margin-bottom: 5px;
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .event-client {
            font-weight: 600;
            margin-bottom: 3px;
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .event-service {
            font-style: italic;
            margin-bottom: 5px;
            color: rgba(255, 255, 255, 0.8);
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .event-notes {
            font-size: 0.8rem;
            color: rgba(255, 255, 255, 0.7);
            padding-top: 5px;
            border-top: 1px dashed rgba(255, 255, 255, 0.1);
            margin-top: 5px;
        }
        
        .calendar-event-empty {
            text-align: center;
            color: rgba(255, 255, 255, 0.3);
            font-style: italic;
            padding: 10px;
            font-size: 0.9rem;
        }

        .price-list-actions {
            display: flex;
            justify-content: end;
            margin-bottom: 20px;
            gap: 20px;
        }

        .fa-users1 {
            margin-right: 12px;
            gap: 0;
            color:#00c9ff;
        }
        
        @media (max-width: 768px) {
            header {
                flex-direction: column;
                gap: 20px;
            }
            
            .logo h1 {
                font-size: 1.8rem;
            }
            
            .nav-tabs {
                justify-content: center;
            }
            
            .tab-btn {
                padding: 10px 15px;
                font-size: 0.9rem;
            }
            
            .btn {
                padding: 8px 15px;
                font-size: 0.9rem;
            }
            
            .calendar-grid {
                gap: 5px;
            }
            
            .calendar-weekday {
                padding: 8px 3px;
            }
            
            .weekday-name {
                font-size: 0.9rem;
            }
            
            .weekday-date {
                font-size: 1.1rem;
            }
            
            .calendar-day {
                min-height: 120px;
                padding: 6px;
            }
            
            .calendar-event {
                padding: 6px;
                font-size: 0.8rem;
            }
        }
        
        @media (max-width: 576px) {
            .calendar-grid {
                gap: 4px;
            }
            
            .calendar-weekday {
                padding: 6px 2px;
            }
            
            .weekday-name {
                font-size: 0.8rem;
            }
            
            .weekday-date {
                font-size: 1rem;
            }
            
            .calendar-day {
                min-height: 100px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <div class="logo">
                <i class="fas"><img src="./img/logo.png" style="width: 40px; height: 50px;" alt="Логотип"></i>
                <h1>EL AFTO - CRM</h1>
            </div>
            <div class="nav-tabs">
                <button class="tab-btn active" data-tab="clients"><i class="fas fa-users"></i> Клиенты</button>
                <button class="tab-btn" data-tab="calendar"><i class="fas fa-calendar"></i> Календарь</button>
                <button class="tab-btn" data-tab="calculator"><i class="fas fa-calculator"></i> Калькулятор</button>
                <button class="tab-btn" data-tab="pricelist"><i class="fas fa-tags"></i> Прайс-лист</button>
                <button class="tab-btn" data-tab="expenses"><i class="fas fa-money-bill-wave"></i> Расходы</button>
                <button class="tab-btn" data-tab="documents"><i class="fas fa-file-contract"></i> Документы</button>
                <button class="tab-btn" data-tab="stats"><i class="fas fa-chart-line"></i> Статистика</button>
                <button class="tab-btn" data-tab="data"><i class="fas fa-database"></i> Данные</button>
            </div>
        </header>
        
        <!-- Клиенты -->
        <section id="clients" class="content-section active">
            <div class="card">
                <div class="card-header">
                    <h2 class="card-title"><i class="fas fa-users fa-users1"></i> Управление клиентами</h2>
                    <button class="btn btn-primary" id="addClientBtn"><i class="fas fa-plus"></i> Добавить клиента</button>
                </div>
                
                <!-- Поиск клиентов -->
                <div class="search-container">
                    <label for="clientSearch"><i class="fas fa-search"></i> Поиск:</label>
                    <input type="text" id="clientSearch" placeholder="Введите имя, телефон, автомобиль или услугу...">
                </div>
                
                <table id="clientsTable">
                    <thead>
                        <tr>
                            <th>Имя</th>
                            <th>Телефон</th>
                            <th>Автомобиль</th>
                            <th>Услуга</th>
                            <th>Дата</th>
                            <th>Действия</th>
                        </tr>
                    </thead>
                    <tbody>
                        <!-- Данные будут заполнены через JS -->
                    </tbody>
                </table>
            </div>
            
            <div class="card" id="clientFormCard" style="display: none;">
                <div class="card-header">
                    <h2 class="card-title" id="formTitle"><i class="fas fa-user-edit"></i> Добавить клиента</h2>
                    <button class="btn btn-secondary" id="cancelClientBtn">Отмена</button>
                </div>
                
                <div class="form-grid">
                    <div class="form-group">
                        <label for="clientName">ФИО клиента</label>
                        <input type="text" id="clientName" placeholder="Иванов Иван Иванович">
                    </div>
                    <div class="form-group">
                        <label for="clientPhone">Телефон</label>
                        <input type="tel" id="clientPhone" placeholder="+7 (999) 999-99-99">
                    </div>
                    <div class="form-group">
                        <label for="clientCar">Автомобиль</label>
                        <input type="text" id="clientCar" placeholder="Toyota Camry 2018">
                    </div>
                    <div class="form-group">
                        <label for="clientService">Услуга</label>
                        <input list="servicesOptions" id="clientService" placeholder="Выберите или введите услугу">
                        <datalist id="servicesOptions">
                            <option value="Замена масла">
                            <option value="Диагностика">
                            <option value="Ремонт двигателя">
                            <option value="Замена тормозов">
                            <option value="Шиномонтаж">
                            <option value="Химчистка">
                            <option value="Прочее">
                        </datalist>
                    </div>
                    <div class="form-grid" style="grid-template-columns: 1fr 1fr;">
                        <div class="form-group">
                            <label for="clientDate">Дата записи</label>
                            <input type="date" id="clientDate">
                        </div>
                        <div class="form-group">
                            <label for="clientTime">Время записи</label>
                            <input type="time" id="clientTime">
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="clientCost">Стоимость (руб.)</label>
                        <input type="number" id="clientCost" placeholder="5000">
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="clientNotes">Примечания для календаря</label>
                    <textarea id="clientNotes" rows="3" placeholder="Дополнительная информация о записи..."></textarea>
                </div>
                
                <button class="btn btn-primary" id="saveClientBtn" style="margin-top: 20px;"><i class="fas fa-save"></i> Сохранить клиента</button>
            </div>
        </section>
        
        <!-- Календарь -->
        <section id="calendar" class="content-section">
            <div class="card">
                <h2 class="section-title"><i class="fas fa-calendar fa-users1"></i> Календарь записей</h2>
                <div class="calendar-container">
                    <div class="calendar-header">
                        <div class="calendar-nav">
                            <button class="calendar-nav-btn" id="calendarPrevYear">
                                <i class="fas fa-chevron-double-left fa-chevron-left"></i> &nbsp;Год назад
                            </button>
                            <button class="calendar-nav-btn" id="calendarPrevMonth">
                                <i class="fas fa-chevron-left"></i> &nbsp;Месяц
                            </button>
                            <button class="calendar-nav-btn" id="calendarToday">
                                Сегодня
                            </button>
                            <button class="calendar-nav-btn" id="calendarNextMonth">
                                Месяц&nbsp; <i class="fas fa-chevron-right"></i>
                            </button>
                            <button class="calendar-nav-btn" id="calendarNextYear">
                                Год вперед&nbsp; <i class="fas fa-chevron-double-right fa-chevron-right"></i>
                            </button>
                        </div>
                        
                        <div class="calendar-title" id="calendarMonthTitle">Июнь 2025</div>
                    </div>
                    
                    <!-- Заголовки дней недели -->
                    <div class="calendar-grid" id="calendarGrid">
                        <!-- Сюда будет добавлена сетка календаря -->
                    </div>
                </div>
            </div>
        </section>
        
        <!-- Калькулятор -->
        <section id="calculator" class="content-section">
            <div class="card">
                <h2 class="section-title"><i class="fas fa-calculator fa-users1"></i> Калькулятор стоимости услуг</h2>
                
                <div class="calculator-grid">
                    <div>
                        <h3>Услуги</h3>
                        <div id="servicesList">
                            <!-- Список услуг будет заполнен через JS -->
                        </div>
                        
                        <div class="total-cost">
                            Итого: <span id="totalCost">0</span> руб.
                        </div>
                    </div>
                    
                    <div>
                        
                        <div class="card" style="margin-top: 20px;">
                            <div class="card-header">
                                <h3 class="card-title">Управление услугами</h3>
                            </div>
                            
                            <div class="form-grid">
                                <div class="form-group">
                                    <label for="serviceName">Название услуги</label>
                                    <input type="text" id="serviceName" placeholder="Замена масла">
                                </div>
                                <div class="form-group">
                                    <label for="serviceCost">Стоимость услуги (руб.)</label>
                                    <input type="number" id="serviceCost" min="0" value="1000">
                                </div>
                            </div>
                            
                            <button class="btn btn-primary" id="saveServiceBtn"><i class="fas fa-save"></i> Сохранить услугу</button>
                        </div>
                    </div>
                </div>
            </div>
        </section>
        
        <!-- Прайс-лист -->
        <section id="pricelist" class="content-section">
            <div class="card">
                <div class="price-list-header">
                    <h2 class="section-title"><i class="fas fa-tags fa-users1"></i> Прайс-лист услуг</h2>
                    <div class="price-list-actions">
                        <button class="btn btn-secondary" id="importPriceListBtn"><i class="fas fa-file-import"></i> Импорт Excel</button>
                        <button class="btn btn-primary" id="addPriceItemBtn"><i class="fas fa-plus"></i> Добавить услугу</button>
                    </div>
                </div>
                
                <div class="search-container">
                    <label for="priceSearch"><i class="fas fa-search"></i> Поиск:</label>
                    <input type="text" id="priceSearch" placeholder="Поиск по названию услуги или категории...">
                </div>
                
                <div class="price-list-table-container">
                    <table id="priceListTable">
                        <thead>
                            <tr>
                                <th>№</th>
                                <th>Услуга (A)</th>
                                <th>Категория (B)</th>
                                <th>Описание (C)</th>
                                <th>Нормочасы (D)</th>
                                <th>Стоимость нормочаса (E)</th>
                                <th>Общая стоимость (F)</th>
                                <th>Действия</th>
                            </tr>
                        </thead>
                        <tbody>
                            <!-- Данные будут заполнены через JS -->
                        </tbody>
                    </table>
                </div>
            </div>
            
            <div class="card" id="priceFormCard" style="display: none;">
                <div class="card-header">
                    <h2 class="card-title" id="priceFormTitle"><i class="fas fa-edit"></i> Добавить услугу</h2>
                    <button class="btn btn-secondary" id="cancelPriceBtn">Отмена</button>
                </div>
                
                <div class="form-grid">
                    <div class="form-group">
                        <label for="priceName">Услуга (A)</label>
                        <input type="text" id="priceName" placeholder="Замена масла">
                    </div>
                    <div class="form-group">
                        <label for="priceCategory">Категория (B)</label>
                        <input type="text" id="priceCategory" placeholder="Техническое обслуживание">
                    </div>
                    <div class="form-group">
                        <label for="priceDescription">Описание (C)</label>
                        <textarea id="priceDescription" rows="2" placeholder="Описание услуги..."></textarea>
                    </div>
                    <div class="form-grid" style="grid-template-columns: 1fr 1fr;">
                        <div class="form-group">
                            <label for="priceNormHours">Нормочасы (D)</label>
                            <input type="number" id="priceNormHours" min="0" step="0.1" value="1.0">
                        </div>
                        <div class="form-group">
                            <label for="priceHourCost">Стоимость нормочаса (E)</label>
                            <input type="number" id="priceHourCost" min="0" value="1000">
                        </div>
                    </div>
                </div>
                
                <div class="expense-actions">
                    <button class="btn btn-primary" id="savePriceBtn"><i class="fas fa-save"></i> Сохранить услугу</button>
                </div>
            </div>
            
            <input type="file" id="priceListImport" accept=".xlsx, .xls" style="display: none;">
        </section>
        
        <!-- Расходы -->
        <section id="expenses" class="content-section">
            <div class="card">
                <div class="card-header">
                    <h2 class="card-title"><i class="fas fa-money-bill-wave fa-users1"></i> Управление расходами</h2>
                    <button class="btn btn-primary" id="addExpenseBtn"><i class="fas fa-plus"></i> Добавить расход</button>
                </div>
                
                <div class="search-container">
                    <label for="expenseSearch"><i class="fas fa-search"></i> Поиск:</label>
                    <input type="text" id="expenseSearch" placeholder="Поиск по категории или описанию...">
                    <select id="expenseMonthFilter">
                        <option value="">Все месяцы</option>
                        <option value="0">Январь</option>
                        <option value="1">Февраль</option>
                        <option value="2">Март</option>
                        <option value="3">Апрель</option>
                        <option value="4">Май</option>
                        <option value="5">Июнь</option>
                        <option value="6">Июль</option>
                        <option value="7">Август</option>
                        <option value="8">Сентябрь</option>
                        <option value="9">Октябрь</option>
                        <option value="10">Ноябрь</option>
                        <option value="11">Декабрь</option>
                    </select>
                </div>
                
                <table id="expensesTable">
                    <thead>
                        <tr>
                            <th>Дата</th>
                            <th>Категория</th>
                            <th>Описание</th>
                            <th>Сумма</th>
                            <th>Действия</th>
                        </tr>
                    </thead>
                    <tbody>
                        <!-- Данные будут заполнены через JS -->
                    </tbody>
                </table>
            </div>
            
            <div class="card" id="expenseFormCard" style="display: none;">
                <div class="card-header">
                    <h2 class="card-title" id="expenseFormTitle"><i class="fas fa-edit"></i> Добавить расход</h2>
                    <button class="btn btn-secondary" id="cancelExpenseBtn">Отмена</button>
                </div>
                
                <div class="expense-form-grid">
                    <div class="form-group">
                        <label for="expenseDate">Дата</label>
                        <input type="date" id="expenseDate">
                    </div>
                    <div class="form-group">
                        <label for="expenseCategory">Категория</label>
                        <select id="expenseCategory">
                            <option value="Материалы">Материалы</option>
                            <option value="Коммунальные платежи">Коммунальные платежи</option>
                            <option value="Зарплата">Зарплата</option>
                            <option value="Аренда">Аренда</option>
                            <option value="Реклама">Реклама</option>
                            <option value="Техника">Техника</option>
                            <option value="Транспорт">Транспорт</option>
                            <option value="Прочее">Прочее</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="expenseAmount">Сумма (руб.)</label>
                        <input type="number" id="expenseAmount" min="0" placeholder="1000">
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="expenseDescription">Описание</label>
                    <textarea id="expenseDescription" rows="3" placeholder="Подробное описание расхода..."></textarea>
                </div>
                
                <div class="expense-actions">
                    <button class="btn btn-primary" id="saveExpenseBtn"><i class="fas fa-save"></i> Сохранить расход</button>
                </div>
            </div>
        </section>
        
        <!-- Документы -->
        <section id="documents" class="content-section">
            <div class="card">
                <h2 class="section-title"><i class="fas fa-file-contract fa-users1"></i> Шаблоны документов</h2>
                
                <div class="documents-grid">
                    <div class="document-card">
                        <div class="document-icon">
                            <i class="fas fa-file-invoice"></i>
                        </div>
                        <h3 class="document-title">Заказ-наряд</h3>
                        <p class="document-desc">Официальный документ на выполнение работ в автосервисе</p>
                        <div class="document-actions">
                            <button class="doc-btn word" onclick="downloadTemplate('work-order')">
                                <i class="fas fa-file-word"></i> Word
                            </button>
                            <button class="doc-btn pdf" onclick="downloadTemplate('work-order', 'pdf')">
                                <i class="fas fa-file-pdf"></i> PDF
                            </button>
                        </div>
                    </div>
                    
                    <div class="document-card">
                        <div class="document-icon">
                            <i class="fas fa-file-invoice-dollar"></i>
                        </div>
                        <h3 class="document-title">Акт выполненных работ</h3>
                        <p class="document-desc">Подтверждение выполнения услуг и их стоимости</p>
                        <div class="document-actions">
                            <button class="doc-btn word" onclick="downloadTemplate('work-certificate')">
                                <i class="fas fa-file-word"></i> Word
                            </button>
                            <button class="doc-btn pdf" onclick="downloadTemplate('work-certificate', 'pdf')">
                                <i class="fas fa-file-pdf"></i> PDF
                            </button>
                        </div>
                    </div>
                    
                    <div class="document-card">
                        <div class="document-icon">
                            <i class="fas fa-receipt"></i>
                        </div>
                        <h3 class="document-title">Товарный чек</h3>
                        <p class="document-desc">Документ для подтверждения покупки запчастей</p>
                        <div class="document-actions">
                            <button class="doc-btn word" onclick="downloadTemplate('receipt')">
                                <i class="fas fa-file-word"></i> Word
                            </button>
                            <button class="doc-btn excel" onclick="downloadTemplate('receipt', 'excel')">
                                <i class="fas fa-file-excel"></i> Excel
                            </button>
                        </div>
                    </div>
                    
                    <div class="document-card">
                        <div class="document-icon">
                            <i class="fas fa-file-alt"></i>
                        </div>
                        <h3 class="document-title">Диагностическая карта</h3>
                        <p class="document-desc">Результаты диагностики автомобиля</p>
                        <div class="document-actions">
                            <button class="doc-btn word" onclick="downloadTemplate('diagnostic-card')">
                                <i class="fas fa-file-word"></i> Word
                            </button>
                            <button class="doc-btn pdf" onclick="downloadTemplate('diagnostic-card', 'pdf')">
                                <i class="fas fa-file-pdf"></i> PDF
                            </button>
                        </div>
                    </div>
                    
                    <div class="document-card">
                        <div class="document-icon">
                            <i class="fas fa-file-medical-alt"></i>
                        </div>
                        <h3 class="document-title">Гарантийный талон</h3>
                        <p class="document-desc">Гарантия на выполненные работы и установленные запчасти</p>
                        <div class="document-actions">
                            <button class="doc-btn word" onclick="downloadTemplate('warranty')">
                                <i class="fas fa-file-word"></i> Word
                            </button>
                            <button class="doc-btn pdf" onclick="downloadTemplate('warranty', 'pdf')">
                                <i class="fas fa-file-pdf"></i> PDF
                            </button>
                        </div>
                    </div>
                    
                    <div class="document-card">
                        <div class="document-icon">
                            <i class="fas fa-clipboard-list"></i>
                        </div>
                        <h3 class="document-title">Смета ремонта</h3>
                        <p class="document-desc">Детальный расчет стоимости ремонтных работ</p>
                        <div class="document-actions">
                            <button class="doc-btn word" onclick="downloadTemplate('estimate')">
                                <i class="fas fa-file-word"></i> Word
                            </button>
                            <button class="doc-btn excel" onclick="downloadTemplate('estimate', 'excel')">
                                <i class="fas fa-file-excel"></i> Excel
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </section>
        
        <!-- Статистика -->
        <section id="stats" class="content-section">
            <div class="card">
                <h2 class="section-title"><i class="fas fa-chart-line fa-users1"></i> Статистика автосервиса</h2>
                
                <div class="stats-grid">
                    <div class="stat-card">
                        <i class="fas fa-users fa-2x"></i>
                        <div class="stat-value" id="totalClients">0</div>
                        <div class="stat-label">Всего клиентов</div>
                    </div>
                    
                    <div class="stat-card">
                        <i class="fas fa-ruble-sign fa-2x"></i>
                        <div class="stat-value" id="avgCheck">0</div>
                        <div class="stat-label">Средний чек (руб.)</div>
                    </div>
                    
                    <div class="stat-card">
                        <i class="fas fa-tools fa-2x"></i>
                        <div class="stat-value" id="popularService">-</div>
                        <div class="stat-label">Самая популярная услуга</div>
                    </div>
                    
                    <div class="stat-card">
                        <i class="fas fa-calendar-alt fa-2x"></i>
                        <div class="stat-value" id="monthIncome">0</div>
                        <div class="stat-label">Выручка за месяц (руб.)</div>
                    </div>
                    
                    <div class="stat-card">
                        <i class="fas fa-car fa-2x"></i>
                        <div class="stat-value" id="commonCar">-</div>
                        <div class="stat-label">Частый автомобиль</div>
                    </div>
                    
                    <div class="stat-card">
                        <i class="fas fa-coins fa-2x"></i>
                        <div class="stat-value" id="totalIncome">0</div>
                        <div class="stat-label">Общая выручка (руб.)</div>
                    </div>
                    
                    <div class="stat-card">
                        <i class="fas fa-money-bill-wave fa-2x"></i>
                        <div class="stat-value" id="monthExpenses">0</div>
                        <div class="stat-label">Расходы за месяц (руб.)</div>
                    </div>
                    
                    <div class="stat-card">
                        <i class="fas fa-chart-pie fa-2x"></i>
                        <div class="stat-value" id="profit">0</div>
                        <div class="stat-label">Прибыль за месяц (руб.)</div>
                    </div>
                </div>
            </div>
        </section>
        
        <!-- Управление данными -->
        <section id="data" class="content-section">
            <div class="card">
                <h2 class="section-title"><i class="fas fa-database fa-users1"></i> Управление данными</h2>
                
                <div class="card">
                    <h3>Экспорт данных</h3>
                    <p>Экспортируйте все данные в JSON-файл для резервного копирования или переноса.</p>
                    <button class="btn btn-primary btn-data" id="exportBtn"><i class="fas fa-file-export"></i> Экспорт данных</button>
                </div>
                
                <div class="card">
                    <h3>Импорт данных</h3>
                    <p>Импортируйте данные из JSON-файла (полностью заменит текущие данные).</p>
                    <div class="form-group">
                        <label for="importFile">Выберите JSON-файл</label>
                        <input type="file" id="importFile" accept=".json">
                    </div>
                    <button class="btn btn-primary btn-data" id="importBtn"><i class="fas fa-file-import"></i> Импорт данных</button>
                </div>
            </div>
        </section>
    </div>
    
    <div class="notification" id="notification">
        <i class="fas fa-check-circle"></i>
        <span>Операция выполнена успешно!</span>
    </div>
    
    <div class="autosave-status" id="autosaveStatus">
        <i class="fas fa-sync"></i>
        <span>Автосохранение...</span>
    </div>
    
    <!-- Библиотеки -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.29.4/moment.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    
    <script>
        // Основные переменные
        let currentClientId = null;
        let currentServiceId = null;
        let currentExpenseId = null;
        let currentPriceId = null;
        let clients = JSON.parse(localStorage.getItem('clients')) || [];
        let expenses = JSON.parse(localStorage.getItem('expenses')) || [];
        let priceList = JSON.parse(localStorage.getItem('priceList')) || [];
        let services = JSON.parse(localStorage.getItem('services')) || [
            { id: 1, name: "Замена масла", cost: 3000 },
            { id: 2, name: "Диагностика", cost: 2000 },
            { id: 3, name: "Ремонт двигателя", cost: 15000 },
            { id: 4, name: "Замена тормозов", cost: 5000 },
            { id: 5, name: "Шиномонтаж", cost: 2000 },
            { id: 6, name: "Химчистка", cost: 8000 },
            { id: 7, name: "Прочее", cost: 1000 }
        ];
        
        // Текущая дата для календаря
        let calendarDate = new Date();
        
        // Русские названия месяцев
        const monthsRu = [
            'Январь', 'Февраль', 'Март', 'Апрель', 'Май', 'Июнь',
            'Июль', 'Август', 'Сентябрь', 'Октябрь', 'Ноябрь', 'Декабрь'
        ];
        
        // Русские названия дней недели
        const weekdaysRu = ['Вс', 'Пн', 'Вт', 'Ср', 'Чт', 'Пт', 'Сб'];
        
        // Инициализация приложения
        document.addEventListener('DOMContentLoaded', function() {
            initNavigation();
            renderClientsTable();
            renderExpensesTable();
            renderPriceList();
            renderServicesList();
            renderCalendar();
            updateStatistics();
            setupEventListeners();
            updateServicesDatalist();
        });
        
        // Настройка навигации
        function initNavigation() {
            const tabBtns = document.querySelectorAll('.tab-btn');
            tabBtns.forEach(btn => {
                btn.addEventListener('click', () => {
                    const tabId = btn.getAttribute('data-tab');
                    
                    // Убираем активный класс у всех кнопок и секций
                    tabBtns.forEach(b => b.classList.remove('active'));
                    document.querySelectorAll('.content-section').forEach(section => {
                        section.classList.remove('active');
                    });
                    
                    // Добавляем активный класс текущей кнопке и секции
                    btn.classList.add('active');
                    document.getElementById(tabId).classList.add('active');
                    
                    // Перерисовка календаря при открытии вкладки
                    if (tabId === 'calendar') {
                        renderCalendar();
                    }
                });
            });
        }
        
        // Рендер календаря
        function renderCalendar() {
            const calendarGrid = document.getElementById('calendarGrid');
            if (!calendarGrid) return;
            
            // Обновляем заголовок
            const month = calendarDate.getMonth();
            const year = calendarDate.getFullYear();
            document.getElementById('calendarMonthTitle').textContent = `${monthsRu[month]} ${year}`;
            
            // Очищаем календарь
            calendarGrid.innerHTML = '';
            
            // Создаем заголовки дней недели
            for (let i = 1; i <= 7; i++) {
                const weekdayElement = document.createElement('div');
                weekdayElement.className = 'calendar-weekday';
                weekdayElement.innerHTML = `
                    <div class="weekday-name">${weekdaysRu[i % 7]}</div>

                `;
                calendarGrid.appendChild(weekdayElement);
            }
            
            // Первый день месяца
            const firstDay = new Date(year, month, 1);
            // Последний день месяца
            const lastDay = new Date(year, month + 1, 0);
            // Первый день недели (0 - воскресенье, 1 - понедельник)
            const firstDayOfWeek = firstDay.getDay();
            // Количество дней в месяце
            const daysInMonth = lastDay.getDate();
            // Текущая дата
            const today = new Date();
            
            // Начинаем с понедельника
            const startOffset = firstDayOfWeek === 0 ? 6 : firstDayOfWeek - 1;
            
            // Создаем дни предыдущего месяца
            const prevMonthLastDay = new Date(year, month, 0).getDate();
            for (let i = startOffset - 1; i >= 0; i--) {
                const day = prevMonthLastDay - i;
                const date = new Date(year, month - 1, day);
                calendarGrid.appendChild(createCalendarDay(date, true));
            }
            
            // Создаем дни текущего месяца
            for (let i = 1; i <= daysInMonth; i++) {
                const date = new Date(year, month, i);
                const isToday = date.toDateString() === today.toDateString();
                calendarGrid.appendChild(createCalendarDay(date, false, isToday));
            }
            
            // Создаем дни следующего месяца
            const nextMonthDays = 42 - (startOffset + daysInMonth); // 6 недель * 7 дней
            for (let i = 1; i <= nextMonthDays; i++) {
                const date = new Date(year, month + 1, i);
                calendarGrid.appendChild(createCalendarDay(date, true));
            }
        }
        
        // Создание элемента дня календаря
        function createCalendarDay(date, isOtherMonth, isToday = false) {
            const day = date.getDate();
            const month = date.getMonth();
            const year = date.getFullYear();
            
            const dayElement = document.createElement('div');
            dayElement.className = 'calendar-day';
            if (isOtherMonth) dayElement.classList.add('other-month');
            if (isToday) dayElement.classList.add('today');
            
            const dayNumber = document.createElement('div');
            dayNumber.className = 'day-number';
            dayNumber.textContent = day;
            dayElement.appendChild(dayNumber);
            
            const eventsContainer = document.createElement('div');
            eventsContainer.className = 'day-events';
            
            // Фильтруем записи клиентов для этого дня
            const dayEvents = clients.filter(client => {
                if (!client.date) return false;
                const clientDate = new Date(client.date);
                return clientDate.getDate() === day && 
                       clientDate.getMonth() === month && 
                       clientDate.getFullYear() === year;
            });
            
            if (dayEvents.length === 0) {
                const emptyEvent = document.createElement('div');
                emptyEvent.className = 'calendar-event-empty';
                emptyEvent.innerHTML = '<i class="fas fa-calendar-day"></i><div>Нет записей</div>';
                eventsContainer.appendChild(emptyEvent);
            } else {
                dayEvents.forEach(event => {
                    const eventElement = document.createElement('div');
                    eventElement.className = 'calendar-event';
                    
                    let eventTime = '';
                    if (event.time) {
                        eventTime = `<div class="event-time"><i class="fas fa-clock"></i> ${event.time}</div>`;
                    }
                    
                    eventElement.innerHTML = `
                        ${eventTime}
                        <div class="event-service"><i class="fas fa-phone"></i> ${event.phone || '-'}</div>
                        <div class="event-client"><i class="fas fa-car"></i> ${event.car || 'Автомобиль'}</div>
                        <div class="event-service"><i class="fas fa-wrench"></i> ${event.service || '-'}</div>
                        <div class="event-service"><i class="fas fa-calculator"></i> ${event.cost || '-'} руб.</div>
                        <div class="event-notes">${event.notes || ''}</div>
                    `;
                    
                    // Добавляем обработчик для показа деталей
                    eventElement.addEventListener('click', (e) => {
                        e.stopPropagation();
                        showEventDetails(event);
                    });
                    
                    eventsContainer.appendChild(eventElement);
                });
            }
            
            dayElement.appendChild(eventsContainer);
            return dayElement;
        }
        
        // Показать детали записи
        function showEventDetails(event) {
            let html = `
                <div class="event-details">
                    <h3>${event.name || 'Клиент'}</h3>
                    <p><strong>Телефон:</strong> ${event.phone || '-'}</p>
                    <p><strong>Автомобиль:</strong> ${event.car || '-'}</p>
                    <p><strong>Услуга:</strong> ${event.service || '-'}</p>
                    <p><strong>Дата:</strong> ${event.date ? new Date(event.date).toLocaleDateString('ru-RU') : '-'}</p>
            `;
            
            if (event.time) {
                html += `<p><strong>Время:</strong> ${event.time}</p>`;
            }
            
            if (event.cost) {
                html += `<p><strong>Стоимость:</strong> ${event.cost} руб.</p>`;
            }
            
            if (event.notes) {
                html += `<p><strong>Примечания:</strong> ${event.notes}</p>`;
            }
            
            html += `</div>`;
            
            showNotification(html, 'info', false);
        }
        
        // Рендер таблицы клиентов
        function renderClientsTable(filteredClients = null) {
            const tbody = document.querySelector('#clientsTable tbody');
            tbody.innerHTML = '';
            
            const clientsToRender = filteredClients || clients;
            
            if (clientsToRender.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="6" class="empty-state">
                            <i class="fas fa-user-slash"></i>
                            <h3>Нет данных о клиентах</h3>
                            <p>Нажмите "Добавить клиента", чтобы создать первую запись</p>
                        </td>
                    </tr>
                `;
                return;
            }
            
            clientsToRender.forEach(client => {
                const tr = document.createElement('tr');
                tr.innerHTML = `
                    <td>${client.name || '-'}</td>
                    <td>${client.phone || '-'}</td>
                    <td>${client.car || '-'}</td>
                    <td>${client.service || '-'}</td>
                    <td>${client.date ? new Date(client.date).toLocaleDateString() : '-'}</td>
                    <td class="actions">
                        ${client.phone ? `
                            <button class="action-btn call" data-id="${client.id}" title="Позвонить">
                                <i class="fas fa-phone"></i>
                            </button>
                            <button class="action-btn whatsapp" data-id="${client.id}" title="WhatsApp">
                                <i class="fab fa-whatsapp"></i>
                            </button>
                            <button class="action-btn telegram" data-id="${client.id}" title="Telegram">
                                <i class="fab fa-telegram"></i>
                            </button>
                        ` : ''}
                        <button class="action-btn edit" data-id="${client.id}" title="Редактировать">
                            <i class="fas fa-edit"></i>
                        </button>
                        <button class="action-btn delete" data-id="${client.id}" title="Удалить">
                            <i class="fas fa-trash"></i>
                        </button>
                    </td>
                `;
                tbody.appendChild(tr);
            });
        }
        
        // Рендер таблицы расходов
        function renderExpensesTable(filteredExpenses = null) {
            const tbody = document.querySelector('#expensesTable tbody');
            tbody.innerHTML = '';
            
            const expensesToRender = filteredExpenses || expenses;
            
            if (expensesToRender.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="5" class="empty-state">
                            <i class="fas fa-money-bill-wave"></i>
                            <h3>Нет данных о расходах</h3>
                            <p>Нажмите "Добавить расход", чтобы создать первую запись</p>
                        </td>
                    </tr>
                `;
                return;
            }
            
            expensesToRender.forEach(expense => {
                const date = new Date(expense.date);
                const formattedDate = date.toLocaleDateString();
                
                const tr = document.createElement('tr');
                tr.innerHTML = `
                    <td>${formattedDate}</td>
                    <td><span class="expense-category">${expense.category}</span></td>
                    <td>${expense.description || '-'}</td>
                    <td>${expense.amount.toLocaleString()} руб.</td>
                    <td class="actions">
                        <button class="action-btn edit" data-id="${expense.id}" title="Редактировать">
                            <i class="fas fa-edit"></i>
                        </button>
                        <button class="action-btn delete" data-id="${expense.id}" title="Удалить">
                            <i class="fas fa-trash"></i>
                        </button>
                    </td>
                `;
                tbody.appendChild(tr);
            });
        }
        
        // Рендер прайс-листа
        function renderPriceList(filteredList = null) {
            const tbody = document.querySelector('#priceListTable tbody');
            tbody.innerHTML = '';
            
            const priceListToRender = filteredList || priceList;
            
            if (priceListToRender.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="8" class="empty-state">
                            <i class="fas fa-tags"></i>
                            <h3>Прайс-лист пуст</h3>
                            <p>Нажмите "Добавить услугу", чтобы создать первую запись</p>
                        </td>
                    </tr>
                `;
                return;
            }
            
            priceListToRender.forEach((item, index) => {
                const tr = document.createElement('tr');
                const totalCost = (item.normHours * item.hourCost).toFixed(2);
                
                tr.innerHTML = `
                    <td>${index + 1}</td>
                    <td>${item.name}</td>
                    <td>${item.category || '-'}</td>
                    <td>${item.description || '-'}</td>
                    <td>${item.normHours}</td>
                    <td>${item.hourCost.toLocaleString()} руб.</td>
                    <td>${totalCost} руб.</td>
                    <td class="actions">
                        <button class="action-btn edit" data-id="${item.id}" title="Редактировать">
                            <i class="fas fa-edit"></i>
                        </button>
                        <button class="action-btn delete" data-id="${item.id}" title="Удалить">
                            <i class="fas fa-trash"></i>
                        </button>
                    </td>
                `;
                tbody.appendChild(tr);
            });
        }
        
        // Рендер списка услуг
        function renderServicesList() {
            const container = document.getElementById('servicesList');
            container.innerHTML = '';
            
            services.forEach(service => {
                const serviceEl = document.createElement('div');
                serviceEl.className = 'service-item';
                serviceEl.innerHTML = `
                    <div>
                        <strong>${service.name}</strong>
                        <div>Стоимость: ${service.cost} руб.</div>
                    </div>
                    <div>
                        <button class="btn btn-sm edit-service" data-id="${service.id}" title="Редактировать">
                            <i class="fas fa-edit"></i>
                        </button>
                        <button class="btn btn-danger btn-sm delete-service" data-id="${service.id}">
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                `;
                container.appendChild(serviceEl);
            });
            
            // Добавляем обработчики событий для удаления услуг
            document.querySelectorAll('.delete-service').forEach(btn => {
                btn.addEventListener('click', function() {
                    const serviceId = parseInt(this.getAttribute('data-id'));
                    deleteService(serviceId);
                });
            });
            
            // Добавляем обработчики событий для редактирования услуг
            document.querySelectorAll('.edit-service').forEach(btn => {
                btn.addEventListener('click', function() {
                    const serviceId = parseInt(this.getAttribute('data-id'));
                    editService(serviceId);
                });
            });
            
            updateTotalCost();
        }
        
        // Обновление итоговой стоимости
        function updateTotalCost() {
            const totalCost = services.reduce((sum, service) => sum + (parseInt(service.cost) || 0), 0);
            document.getElementById('totalCost').textContent = totalCost.toFixed(0);
        }
        
        // Обновление статистики
        function updateStatistics() {
            document.getElementById('totalClients').textContent = clients.length;
            
            if (clients.length === 0) {
                document.getElementById('avgCheck').textContent = '0';
                document.getElementById('popularService').textContent = '-';
                document.getElementById('monthIncome').textContent = '0';
                document.getElementById('commonCar').textContent = '-';
                document.getElementById('totalIncome').textContent = '0';
            } else {
                const payingClients = clients.filter(c => c.cost);
                const totalIncome = payingClients.reduce((sum, client) => sum + (parseFloat(client.cost) || 0), 0);
                
                if (payingClients.length > 0) {
                    const avgCheck = totalIncome / payingClients.length;
                    document.getElementById('avgCheck').textContent = avgCheck.toFixed(0);
                } else {
                    document.getElementById('avgCheck').textContent = '0';
                }
                
                const serviceCount = {};
                clients.forEach(client => {
                    if (client.service) {
                        serviceCount[client.service] = (serviceCount[client.service] || 0) + 1;
                    }
                });
                
                let popularService = '-';
                let maxCount = 0;
                for (const [service, count] of Object.entries(serviceCount)) {
                    if (count > maxCount) {
                        maxCount = count;
                        popularService = service;
                    }
                }
                document.getElementById('popularService').textContent = popularService;
                
                const now = new Date();
                const monthIncome = clients
                    .filter(client => client.cost && client.date)
                    .filter(client => {
                        const clientDate = new Date(client.date);
                        return clientDate.getMonth() === now.getMonth() && 
                               clientDate.getFullYear() === now.getFullYear();
                    })
                    .reduce((sum, client) => sum + (parseFloat(client.cost) || 0), 0);
                document.getElementById('monthIncome').textContent = monthIncome.toFixed(0);
                
                const carCount = {};
                clients.forEach(client => {
                    if (client.car) {
                        carCount[client.car] = (carCount[client.car] || 0) + 1;
                    }
                });
                
                let commonCar = '-';
                let maxCarCount = 0;
                for (const [car, count] of Object.entries(carCount)) {
                    if (count > maxCarCount) {
                        maxCarCount = count;
                        commonCar = car;
                    }
                }
                document.getElementById('commonCar').textContent = commonCar;
                
                document.getElementById('totalIncome').textContent = totalIncome.toFixed(0);
            }
            
            // Статистика расходов
            const now = new Date();
            const monthExpenses = expenses
                .filter(expense => expense.date)
                .filter(expense => {
                    const expenseDate = new Date(expense.date);
                    return expenseDate.getMonth() === now.getMonth() && 
                           expenseDate.getFullYear() === now.getFullYear();
                })
                .reduce((sum, expense) => sum + (parseFloat(expense.amount) || 0), 0);
            
            document.getElementById('monthExpenses').textContent = monthExpenses.toFixed(0);
            
            // Прибыль за месяц
            const monthIncome = parseFloat(document.getElementById('monthIncome').textContent) || 0;
            const profit = monthIncome - monthExpenses;
            document.getElementById('profit').textContent = profit.toFixed(0);
        }
        
        // Настройка обработчиков событий
        function setupEventListeners() {
            // Клиенты
            document.getElementById('addClientBtn').addEventListener('click', () => {
                showClientForm();
            });
            
            document.getElementById('cancelClientBtn').addEventListener('click', () => {
                hideClientForm();
                resetClientForm();
            });
            
            document.getElementById('saveClientBtn').addEventListener('click', saveClient);
            
            document.querySelector('#clientsTable tbody').addEventListener('click', function(e) {
                const btn = e.target.closest('button');
                if (!btn) return;
                
                const clientId = parseInt(btn.getAttribute('data-id'));
                const client = clients.find(c => c.id === clientId);
                
                if (!client) return;
                
                if (btn.classList.contains('call')) {
                    window.location.href = `tel:${client.phone}`;
                } 
                else if (btn.classList.contains('whatsapp')) {
                    window.open(`https://wa.me/${client.phone.replace(/[^\d]/g, '')}`, '_blank');
                }
                else if (btn.classList.contains('telegram')) {
                    window.open(`https://t.me/${client.phone.replace(/[^\d]/g, '')}`, '_blank');
                }
                else if (btn.classList.contains('edit')) {
                    editClient(clientId);
                }
                else if (btn.classList.contains('delete')) {
                    deleteClient(clientId);
                }
            });
            
            // Услуги калькулятора
            document.getElementById('saveServiceBtn').addEventListener('click', saveService);
            document.getElementById('addServiceBtn').addEventListener('click', () => {
                document.getElementById('serviceName').value = '';
                document.getElementById('serviceCost').value = '1000';
                currentServiceId = null;
            });
            
            // Расходы
            document.getElementById('addExpenseBtn').addEventListener('click', () => {
                showExpenseForm();
            });
            
            document.getElementById('cancelExpenseBtn').addEventListener('click', () => {
                hideExpenseForm();
                resetExpenseForm();
            });
            
            document.getElementById('saveExpenseBtn').addEventListener('click', saveExpense);
            
            document.querySelector('#expensesTable tbody').addEventListener('click', function(e) {
                const btn = e.target.closest('button');
                if (!btn) return;
                
                const expenseId = parseInt(btn.getAttribute('data-id'));
                
                if (btn.classList.contains('edit')) {
                    editExpense(expenseId);
                }
                else if (btn.classList.contains('delete')) {
                    deleteExpense(expenseId);
                }
            });
            
            // Прайс-лист
            document.getElementById('addPriceItemBtn').addEventListener('click', () => {
                showPriceForm();
            });
            
            document.getElementById('cancelPriceBtn').addEventListener('click', () => {
                hidePriceForm();
                resetPriceForm();
            });
            
            document.getElementById('savePriceBtn').addEventListener('click', savePriceItem);
            
            document.getElementById('importPriceListBtn').addEventListener('click', () => {
                document.getElementById('priceListImport').click();
            });
            
            document.getElementById('priceListImport').addEventListener('change', importPriceList);
            
            document.querySelector('#priceListTable tbody').addEventListener('click', function(e) {
                const btn = e.target.closest('button');
                if (!btn) return;
                
                const priceId = parseInt(btn.getAttribute('data-id'));
                
                if (btn.classList.contains('edit')) {
                    editPriceItem(priceId);
                }
                else if (btn.classList.contains('delete')) {
                    deletePriceItem(priceId);
                }
            });
            
            // Поиск
            document.getElementById('clientSearch').addEventListener('input', function() {
                const searchTerm = this.value.toLowerCase().trim();
                
                if (!searchTerm) {
                    renderClientsTable();
                    return;
                }
                
                const filteredClients = clients.filter(client => {
                    return (
                        (client.name && client.name.toLowerCase().includes(searchTerm)) ||
                        (client.phone && client.phone.toLowerCase().includes(searchTerm)) ||
                        (client.car && client.car.toLowerCase().includes(searchTerm)) ||
                        (client.service && client.service.toLowerCase().includes(searchTerm))
                    );
                });
                
                renderClientsTable(filteredClients);
            });
            
            document.getElementById('expenseSearch').addEventListener('input', function() {
                const searchTerm = this.value.toLowerCase().trim();
                const monthFilter = document.getElementById('expenseMonthFilter').value;
                
                let filteredExpenses = expenses;
                
                if (searchTerm) {
                    filteredExpenses = filteredExpenses.filter(expense => {
                        return (
                            (expense.category && expense.category.toLowerCase().includes(searchTerm)) ||
                            (expense.description && expense.description.toLowerCase().includes(searchTerm))
                        );
                    });
                }
                
                if (monthFilter !== '') {
                    const month = parseInt(monthFilter);
                    filteredExpenses = filteredExpenses.filter(expense => {
                        const expenseDate = new Date(expense.date);
                        return expenseDate.getMonth() === month;
                    });
                }
                
                renderExpensesTable(filteredExpenses);
            });
            
            document.getElementById('expenseMonthFilter').addEventListener('change', function() {
                document.getElementById('expenseSearch').dispatchEvent(new Event('input'));
            });
            
            document.getElementById('priceSearch').addEventListener('input', function() {
                const searchTerm = this.value.toLowerCase().trim();
                
                if (!searchTerm) {
                    renderPriceList();
                    return;
                }
                
                const filteredList = priceList.filter(item => {
                    return (
                        (item.name && item.name.toLowerCase().includes(searchTerm)) ||
                        (item.category && item.category.toLowerCase().includes(searchTerm))
                    );
                });
                
                renderPriceList(filteredList);
            });
            
            // Экспорт/импорт данных
            document.getElementById('exportBtn').addEventListener('click', exportData);
            document.getElementById('importBtn').addEventListener('click', importData);
            
            // Навигация календаря
            document.getElementById('calendarPrevYear').addEventListener('click', () => {
                calendarDate.setFullYear(calendarDate.getFullYear() - 1);
                renderCalendar();
            });
            
            document.getElementById('calendarNextYear').addEventListener('click', () => {
                calendarDate.setFullYear(calendarDate.getFullYear() + 1);
                renderCalendar();
            });
            
            document.getElementById('calendarPrevMonth').addEventListener('click', () => {
                calendarDate.setMonth(calendarDate.getMonth() - 1);
                renderCalendar();
            });
            
            document.getElementById('calendarNextMonth').addEventListener('click', () => {
                calendarDate.setMonth(calendarDate.getMonth() + 1);
                renderCalendar();
            });
            
            document.getElementById('calendarToday').addEventListener('click', () => {
                calendarDate = new Date();
                renderCalendar();
            });
        }
        
        // Обновление списка услуг в datalist
        function updateServicesDatalist() {
            const datalist = document.getElementById('servicesOptions');
            datalist.innerHTML = '';
            
            const standardServices = [
                "Замена масла", "Диагностика", "Ремонт двигателя", 
                "Замена тормозов", "Шиномонтаж", "Химчистка", "Прочее"
            ];
            
            standardServices.forEach(service => {
                const option = document.createElement('option');
                option.value = service;
                datalist.appendChild(option);
            });
            
            const uniqueServices = [...new Set(clients.map(c => c.service).filter(Boolean))];
            uniqueServices.forEach(service => {
                if (!standardServices.includes(service)) {
                    const option = document.createElement('option');
                    option.value = service;
                    datalist.appendChild(option);
                }
            });
        }
        
        // Показать форму клиента
        function showClientForm() {
            document.getElementById('clientFormCard').style.display = 'block';
            document.getElementById('clientFormCard').scrollIntoView({ behavior: 'smooth' });
        }
        
        // Скрыть форму клиента
        function hideClientForm() {
            document.getElementById('clientFormCard').style.display = 'none';
        }
        
        // Сброс формы клиента
        function resetClientForm() {
            document.getElementById('clientName').value = '';
            document.getElementById('clientPhone').value = '';
            document.getElementById('clientCar').value = '';
            document.getElementById('clientService').value = '';
            document.getElementById('clientDate').value = '';
            document.getElementById('clientTime').value = '';
            document.getElementById('clientCost').value = '';
            document.getElementById('clientNotes').value = '';
            document.getElementById('formTitle').innerHTML = '<i class="fas fa-user-edit"></i> Добавить клиента';
            currentClientId = null;
        }
        
        // Редактировать клиента
        function editClient(id) {
            const client = clients.find(c => c.id === id);
            if (!client) return;
            
            document.getElementById('clientName').value = client.name || '';
            document.getElementById('clientPhone').value = client.phone || '';
            document.getElementById('clientCar').value = client.car || '';
            document.getElementById('clientService').value = client.service || '';
            document.getElementById('clientDate').value = client.date || '';
            document.getElementById('clientTime').value = client.time || '';
            document.getElementById('clientCost').value = client.cost || '';
            document.getElementById('clientNotes').value = client.notes || '';
            
            document.getElementById('formTitle').innerHTML = `<i class="fas fa-user-edit"></i> Редактировать клиента`;
            currentClientId = id;
            
            showClientForm();
        }
        
        // Сохранение клиента
        function saveClient() {
            const name = document.getElementById('clientName').value.trim();
            const phone = document.getElementById('clientPhone').value.trim();
            const car = document.getElementById('clientCar').value.trim();
            const service = document.getElementById('clientService').value.trim();
            const date = document.getElementById('clientDate').value;
            const time = document.getElementById('clientTime').value;
            const cost = document.getElementById('clientCost').value;
            const notes = document.getElementById('clientNotes').value.trim();
            
            if (!name || !phone) {
                showNotification('Заполните имя и телефон клиента!', 'error');
                return;
            }
            
            const clientData = {
                id: currentClientId || Date.now(),
                name,
                phone,
                car: car || null,
                service: service || null,
                date: date || null,
                time: time || null,
                cost: cost ? parseFloat(cost) : null,
                notes: notes || null
            };
            
            if (currentClientId) {
                const index = clients.findIndex(c => c.id === currentClientId);
                if (index !== -1) {
                    clients[index] = clientData;
                }
            } else {
                clients.push(clientData);
            }
            
            saveDataToStorage();
            renderClientsTable();
            updateStatistics();
            updateServicesDatalist();
            hideClientForm();
            resetClientForm();
            renderCalendar();
            showNotification(`Клиент ${name} успешно сохранен!`);
        }
        
        // Удаление клиента
        function deleteClient(id) {
            if (!confirm('Вы уверены, что хотите удалить этого клиента?')) return;
            
            clients = clients.filter(c => c.id !== id);
            saveDataToStorage();
            renderClientsTable();
            updateStatistics();
            updateServicesDatalist();
            renderCalendar();
            showNotification('Клиент успешно удален!');
        }
        
        // Показать форму расхода
        function showExpenseForm() {
            document.getElementById('expenseFormCard').style.display = 'block';
            document.getElementById('expenseDate').valueAsDate = new Date();
            document.getElementById('expenseFormCard').scrollIntoView({ behavior: 'smooth' });
        }
        
        // Скрыть форму расхода
        function hideExpenseForm() {
            document.getElementById('expenseFormCard').style.display = 'none';
        }
        
        // Сброс формы расхода
        function resetExpenseForm() {
            document.getElementById('expenseDate').value = '';
            document.getElementById('expenseCategory').value = 'Материалы';
            document.getElementById('expenseAmount').value = '';
            document.getElementById('expenseDescription').value = '';
            document.getElementById('expenseFormTitle').innerHTML = '<i class="fas fa-edit"></i> Добавить расход';
            currentExpenseId = null;
        }
        
        // Редактировать расход
        function editExpense(id) {
            const expense = expenses.find(e => e.id === id);
            if (!expense) return;
            
            document.getElementById('expenseDate').value = expense.date || '';
            document.getElementById('expenseCategory').value = expense.category || 'Материалы';
            document.getElementById('expenseAmount').value = expense.amount || '';
            document.getElementById('expenseDescription').value = expense.description || '';
            
            document.getElementById('expenseFormTitle').innerHTML = `<i class="fas fa-edit"></i> Редактировать расход`;
            currentExpenseId = id;
            
            showExpenseForm();
        }
        
        // Сохранение расхода
        function saveExpense() {
            const date = document.getElementById('expenseDate').value;
            const category = document.getElementById('expenseCategory').value;
            const amount = document.getElementById('expenseAmount').value;
            const description = document.getElementById('expenseDescription').value.trim();
            
            if (!date || !category || !amount) {
                showNotification('Заполните обязательные поля!', 'error');
                return;
            }
            
            const expenseData = {
                id: currentExpenseId || Date.now(),
                date,
                category,
                amount: parseFloat(amount),
                description: description || null
            };
            
            if (currentExpenseId) {
                const index = expenses.findIndex(e => e.id === currentExpenseId);
                if (index !== -1) {
                    expenses[index] = expenseData;
                }
            } else {
                expenses.push(expenseData);
            }
            
            saveDataToStorage();
            renderExpensesTable();
            updateStatistics();
            hideExpenseForm();
            resetExpenseForm();
            showNotification(`Расход успешно сохранен!`);
        }
        
        // Удаление расхода
        function deleteExpense(id) {
            if (!confirm('Вы уверены, что хотите удалить этот расход?')) return;
            
            expenses = expenses.filter(e => e.id !== id);
            saveDataToStorage();
            renderExpensesTable();
            updateStatistics();
            showNotification('Расход успешно удален!');
        }
        
        // Показать форму услуги прайс-листа
        function showPriceForm() {
            document.getElementById('priceFormCard').style.display = 'block';
            document.getElementById('priceFormCard').scrollIntoView({ behavior: 'smooth' });
        }
        
        // Скрыть форму услуги прайс-листа
        function hidePriceForm() {
            document.getElementById('priceFormCard').style.display = 'none';
        }
        
        // Сброс формы услуги прайс-листа
        function resetPriceForm() {
            document.getElementById('priceName').value = '';
            document.getElementById('priceCategory').value = '';
            document.getElementById('priceDescription').value = '';
            document.getElementById('priceNormHours').value = '1.0';
            document.getElementById('priceHourCost').value = '1000';
            document.getElementById('priceFormTitle').innerHTML = '<i class="fas fa-edit"></i> Добавить услугу';
            currentPriceId = null;
        }
        
        // Редактировать услугу прайс-листа
        function editPriceItem(id) {
            const priceItem = priceList.find(p => p.id === id);
            if (!priceItem) return;
            
            document.getElementById('priceName').value = priceItem.name || '';
            document.getElementById('priceCategory').value = priceItem.category || '';
            document.getElementById('priceDescription').value = priceItem.description || '';
            document.getElementById('priceNormHours').value = priceItem.normHours || '1.0';
            document.getElementById('priceHourCost').value = priceItem.hourCost || '1000';
            
            document.getElementById('priceFormTitle').innerHTML = `<i class="fas fa-edit"></i> Редактировать услугу`;
            currentPriceId = id;
            
            showPriceForm();
        }
        
        // Сохранение услуги прайс-листа
        function savePriceItem() {
            const name = document.getElementById('priceName').value.trim();
            const category = document.getElementById('priceCategory').value.trim();
            const description = document.getElementById('priceDescription').value.trim();
            const normHours = document.getElementById('priceNormHours').value;
            const hourCost = document.getElementById('priceHourCost').value;
            
            if (!name || !normHours || !hourCost) {
                showNotification('Заполните обязательные поля!', 'error');
                return;
            }
            
            const priceData = {
                id: currentPriceId || Date.now(),
                name,
                category: category || null,
                description: description || null,
                normHours: parseFloat(normHours),
                hourCost: parseFloat(hourCost)
            };
            
            if (currentPriceId) {
                const index = priceList.findIndex(p => p.id === currentPriceId);
                if (index !== -1) {
                    priceList[index] = priceData;
                }
            } else {
                priceList.push(priceData);
            }
            
            saveDataToStorage();
            renderPriceList();
            hidePriceForm();
            resetPriceForm();
            showNotification(`Услуга успешно сохранена в прайс-лист!`);
        }
        
        // Удаление услуги прайс-листа
        function deletePriceItem(id) {
            if (!confirm('Вы уверены, что хотите удалить эту услугу из прайс-листа?')) return;
            
            priceList = priceList.filter(p => p.id !== id);
            saveDataToStorage();
            renderPriceList();
            showNotification('Услуга успешно удалена из прайс-листа!');
        }
        
        // Импорт прайс-листа из Excel
        function importPriceList(e) {
            const file = e.target.files[0];
            if (!file) return;
            
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const data = new Uint8Array(e.target.result);
                    const workbook = XLSX.read(data, { type: 'array' });
                    
                    // Получаем данные из первого листа
                    const worksheet = workbook.Sheets[workbook.SheetNames[0]];
                    const jsonData = XLSX.utils.sheet_to_json(worksheet);
                    
                    if (jsonData.length === 0) {
                        showNotification('Файл не содержит данных!', 'error');
                        return;
                    }
                    
                    // Преобразуем данные в нужный формат
                    const newPriceList = jsonData.map((row, index) => {
                        return {
                            id: Date.now() + index,
                            name: row.A || `Услуга ${index + 1}`,
                            category: row.B || null,
                            description: row.C || null,
                            normHours: row.D ? parseFloat(row.D) : 1.0,
                            hourCost: row.E ? parseFloat(row.E) : 1000
                        };
                    });
                    
                    priceList = newPriceList;
                    saveDataToStorage();
                    renderPriceList();
                    showNotification('Прайс-лист успешно импортирован из Excel!');
                    
                    // Сбрасываем значение input для возможности повторной загрузки того же файла
                    e.target.value = '';
                } catch (error) {
                    console.error('Ошибка импорта Excel:', error);
                    showNotification('Ошибка при импорте файла Excel!', 'error');
                }
            };
            reader.readAsArrayBuffer(file);
        }
        
        // Редактировать услугу калькулятора
        function editService(id) {
            const service = services.find(s => s.id === id);
            if (!service) return;
            
            document.getElementById('serviceName').value = service.name || '';
            document.getElementById('serviceCost').value = service.cost || '';
            currentServiceId = id;
            
            document.getElementById('calculator').scrollIntoView({ behavior: 'smooth' });
        }
        
        // Сохранение услуги калькулятора
        function saveService() {
            const name = document.getElementById('serviceName').value.trim();
            const cost = parseInt(document.getElementById('serviceCost').value);
            
            if (!name || isNaN(cost) || cost <= 0) {
                showNotification('Введите корректные данные для услуги!', 'error');
                return;
            }
            
            if (currentServiceId) {
                const serviceIndex = services.findIndex(s => s.id === currentServiceId);
                if (serviceIndex !== -1) {
                    services[serviceIndex] = {
                        id: currentServiceId,
                        name,
                        cost
                    };
                }
            } else {
                const newService = {
                    id: Date.now(),
                    name,
                    cost
                };
                
                services.push(newService);
            }
            
            saveDataToStorage();
            renderServicesList();
            updateServicesDatalist();
            showNotification(`Услуга "${name}" сохранена!`);
            
            document.getElementById('serviceName').value = '';
            document.getElementById('serviceCost').value = '1000';
            currentServiceId = null;
        }
        
        // Удаление услуги калькулятора
        function deleteService(id) {
            services = services.filter(s => s.id !== id);
            saveDataToStorage();
            renderServicesList();
            showNotification('Услуга успешно удалена!');
        }
        
        // Экспорт данных
        function exportData() {
            const data = {
                clients,
                services,
                expenses,
                priceList,
                exportedAt: new Date().toISOString()
            };
            
            const dataStr = JSON.stringify(data, null, 2);
            const dataUri = 'data:application/json;charset=utf-8,'+ encodeURIComponent(dataStr);
            
            const exportFileDefaultName = `autoservice_data_${new Date().toISOString().slice(0, 10)}.json`;
            
            const linkElement = document.createElement('a');
            linkElement.setAttribute('href', dataUri);
            linkElement.setAttribute('download', exportFileDefaultName);
            linkElement.click();
            
            showNotification('Данные успешно экспортированы!');
        }
        
        // Импорт данных
        function importData() {
            const fileInput = document.getElementById('importFile');
            const file = fileInput.files[0];
            
            if (!file) {
                showNotification('Выберите файл для импорта!', 'error');
                return;
            }
            
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const data = JSON.parse(e.target.result);
                    
                    if (!data.clients || !data.services) {
                        throw new Error('Неверный формат файла');
                    }
                    
                    clients = data.clients || [];
                    services = data.services || [];
                    expenses = data.expenses || [];
                    priceList = data.priceList || [];
                    
                    saveDataToStorage();
                    renderClientsTable();
                    renderExpensesTable();
                    renderPriceList();
                    renderServicesList();
                    updateStatistics();
                    updateServicesDatalist();
                    renderCalendar();
                    
                    showNotification('Данные успешно импортированы!');
                    fileInput.value = '';
                } catch (error) {
                    console.error(error);
                    showNotification('Ошибка при импорте данных: ' + error.message, 'error');
                }
            };
            reader.readAsText(file);
        }
        
        // Сохранение данных в localStorage
        function saveDataToStorage() {
            localStorage.setItem('clients', JSON.stringify(clients));
            localStorage.setItem('services', JSON.stringify(services));
            localStorage.setItem('expenses', JSON.stringify(expenses));
            localStorage.setItem('priceList', JSON.stringify(priceList));
        }
        
        // Показать статус автосохранения
        function showAutoSaveStatus() {
            const status = document.getElementById('autosaveStatus');
            status.style.display = 'flex';
            status.innerHTML = '<i class="fas fa-sync fa-spin"></i><span>Автосохранение...</span>';
            
            setTimeout(() => {
                status.innerHTML = '<i class="fas fa-check-circle"></i><span>Данные сохранены</span>';
                
                setTimeout(() => {
                    status.style.display = 'none';
                }, 3000);
            }, 2000);
        }
        
        // Скачивание шаблона документа
        function downloadTemplate(type, format = 'word') {
            // Объект с человеко-читаемыми именами
            const templateNames = {
                'work-order': 'заказ-наряд',
                'work-certificate': 'акт-выполненных-работ',
                'receipt': 'товарный-чек',
                'diagnostic-card': 'диагностическая-карта',
                'warranty': 'гарантийный-талон',
                'estimate': 'смета-ремонта'
            };
            
            const fileName = templateNames[type] || 'документ';
            
            // База ссылок на реальные файлы
            const templates = {
                'work-order': {
                    'word': './docs/work-order.docx',
                    'pdf': './docs/work-order.pdf'
                },
                'work-certificate': {
                    'word': './docs/work-certificate.docx',
                    'pdf': './docs/work-certificate.pdf'
                },
                'receipt': {
                    'word': './docs/receipt.docx',
                    'excel': './docs/receipt.xlsx'
                },
                'diagnostic-card': {
                    'word': './docs/diagnostic-card.docx',
                    'pdf': './docs/diagnostic-card.pdf'
                },
                'warranty': {
                    'word': './docs/warranty.docx',
                    'pdf': './docs/warranty.pdf'
                },
                'estimate': {
                    'word': './docs/estimate.docx',
                    'excel': './docs/estimate.xlsx'
                }
            };

            // Проверка существования шаблона в конфиге
            if (!templates[type] || !templates[type][format]) {
                showNotification('Шаблон не настроен в системе!', 'error');
                return;
            }

            const fileUrl = templates[type][format];
            const fileExtension = format === 'word' ? 'docx' : 
                                format === 'excel' ? 'xlsx' : 'pdf';
            
            // Проверяем существование файла на сервере
            checkFileExists(fileUrl)
                .then(exists => {
                    if (exists) {
                        // Скачиваем файл
                        const link = document.createElement('a');
                        link.href = fileUrl;
                        link.download = `${fileName}.${fileExtension}`;
                        document.body.appendChild(link);
                        link.click();
                        document.body.removeChild(link);
                        
                        showNotification(`Шаблон "${fileName}" скачивается...`);
                    } else {
                        showNotification(`Шаблон не найден, проверьте папку DOCS`, 'error');
                    }
                })
                .catch(error => {
                    console.error('Ошибка проверки файла:', error);
                    showNotification('Ошибка при проверке существования файла', 'error');
                });
        }

        // Функция проверки существования файла
        function checkFileExists(url) {
            return new Promise((resolve, reject) => {
                // Для абсолютных URL используем метод HEAD
                if (url.startsWith('http')) {
                    fetch(url, { method: 'HEAD' })
                        .then(response => resolve(response.ok))
                        .catch(() => resolve(false));
                } 
                // Для относительных URL используем XMLHttpRequest
                else {
                    const xhr = new XMLHttpRequest();
                    xhr.open('HEAD', url, true);
                    
                    xhr.onload = function() {
                        resolve(xhr.status === 200);
                    };
                    
                    xhr.onerror = function() {
                        resolve(false);
                    };
                    
                    xhr.send();
                }
            });
        }
        
        // Показать уведомление
        function showNotification(message, type = 'success', isHTML = true) {
            const notification = document.getElementById('notification');
            
            if (isHTML) {
                notification.innerHTML = `
                    <i class="fas fa-${type === 'success' ? 'check-circle' : type === 'error' ? 'exclamation-circle' : type === 'warning' ? 'exclamation-triangle' : 'info-circle'}"></i>
                    <span>${message}</span>
                `;
            } else {
                notification.innerHTML = message;
            }
            
            notification.className = 'notification show';
            notification.classList.add(type);
            
            setTimeout(() => {
                notification.className = 'notification';
                notification.classList.remove(type);
            }, 3000);
        }

        // Добавьте этот блок кода после функции renderCalendar (в конец скрипта)
document.addEventListener('DOMContentLoaded', function() {
    // Обработчики навигации
    document.getElementById('calendarPrevYear').addEventListener('click', () => {
        calendarDate.setFullYear(calendarDate.getFullYear() - 1);
        renderCalendar();
    });

    document.getElementById('calendarPrevMonth').addEventListener('click', () => {
        calendarDate.setMonth(calendarDate.getMonth() - 1);
        renderCalendar();
    });

    document.getElementById('calendarToday').addEventListener('click', () => {
        calendarDate = new Date();
        renderCalendar();
    });

    document.getElementById('calendarNextMonth').addEventListener('click', () => {
        calendarDate.setMonth(calendarDate.getMonth() + 1);
        renderCalendar();
    });

    document.getElementById('calendarNextYear').addEventListener('click', () => {
        calendarDate.setFullYear(calendarDate.getFullYear() + 1);
        renderCalendar();
    });

    // Инициализация календаря
    renderCalendar();
});
    </script>
</body>
</html>